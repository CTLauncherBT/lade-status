<<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Verbinden…</title>
<style>
  html,body { height:100%; margin:0; font-family: "Segoe UI", Roboto, Arial, sans-serif; color:#fff; overflow:hidden; background:#000 center/cover no-repeat; }

  #bgVideo { position: fixed; inset:0; width:100%; height:100%; object-fit:cover; z-index:0; pointer-events:none; }

  .overlay { position: relative; z-index:2; height:100%; width:100%; }

  .status-box {
    position: fixed; left:16px; bottom:16px; display:flex; align-items:center; gap:10px; z-index:3;
    background:none; box-shadow:none; backdrop-filter:none; padding:0;
  }

  .spinner {
    width:20px; height:20px; border-radius:50%; border:3px solid rgba(255,255,255,0.18); border-top-color:#fff; animation:spin 1s linear infinite; box-sizing:border-box;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .cute { font-weight:600; letter-spacing:0.2px; text-shadow:0 2px 6px rgba(0,0,0,0.6); }

  #videoFallback { position:absolute; top:16px; left:50%; transform:translateX(-50%); z-index:4; background:rgba(0,0,0,0.45); padding:6px 10px; border-radius:8px; display:none; }

  @media (prefers-reduced-motion: reduce) { .spinner { animation:none; } }

  /* Fehlermeldungs-Fenster */
  #failWindow {
    display:none; position: fixed; top:50%; left:50%; transform:translate(-50%,-50%);
    background:#222; color:#fff; padding:20px; border-radius:10px; box-shadow:0 8px 30px rgba(0,0,0,0.6);
    z-index:9999; width:300px; text-align:center; font-family:Segoe UI, sans-serif;
  }
  #failWindow button {
    margin-top:15px; padding:8px 16px; background:#4a90e2; color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:14px;
  }
</style>
</head>
<body>
<video id="bgVideo" autoplay muted playsinline>
  <source src="https://ctlauncherbt.github.io/lade-status/video.mp4" type="video/mp4">
  Dein Browser unterstützt kein HTML5-Video.
</video>

<div class="overlay" id="overlay">
  <div id="videoFallback">Autoplay blockiert? Klicke zum Starten.</div>
  <div class="status-box" id="statusBox" aria-live="polite">
    <div class="spinner" id="spinner" title="lade"></div>
    <div>
      <span class="cute" id="statusText">Verbinde mit Servern</span><span id="dots">.</span>
    </div>
  </div>
</div>

<div id="failWindow">
  <h3 style="margin-top:0;">Verbindung fehlgeschlagen</h3>
  <p>Verbindung zu den NasumiCraft Servern nicht möglich.<br>
  Es sieht so aus, als ob das Nasumify Network nicht reagieren würde.</p>
  <button onclick="closeFailWindow()">Okay!</button>
</div>

<script>
const statusTextEl = document.getElementById('statusText');
const dotsEl = document.getElementById('dots');
const spinnerEl = document.getElementById('spinner');
const video = document.getElementById('bgVideo');
const videoFallback = document.getElementById('videoFallback');

let dots=0, dotInterval=null, checkInterval=null, retryTimer=null, failCount=0;

// Punkte-Animation
function startDotAnimation(){ if(dotInterval) return; dotInterval=setInterval(()=>{dots=(dots+1)%4; dotsEl.textContent='.'.repeat(dots===0?1:dots);},500);}
function stopDotAnimation(){ if(dotInterval){clearInterval(dotInterval); dotInterval=null;} dotsEl.textContent='';}

// Statusfunktionen
function setConnecting(){ statusTextEl.textContent='Verbinde mit Servern'; startDotAnimation(); spinnerEl.style.display=''; }

function setRetrying(){
  failCount++;
  if(failCount>=5){ showFailWindow(); return; }
  statusTextEl.textContent='Keine Verbindung, versuche es erneut…';
  spinnerEl.style.display='';
  setTimeout(()=>{ setConnecting(); checkStatus(); }, 5000);
}
function setHiddenSpinner(){ spinnerEl.style.display='none'; stopDotAnimation(); }

// Servercheck
async function checkStatus(){
  const url='https://yf.nasumicraft.de/status.txt';
  const controller=new AbortController();
  const timeout=setTimeout(()=>controller.abort(),4000);
  try{
    const resp=await fetch(url,{method:'GET',cache:'no-cache',mode:'cors',signal:controller.signal});
    clearTimeout(timeout);
    if(resp.ok){
      statusTextEl.textContent='Verbunden! Leite weiter… ✨'; spinnerEl.style.display='none'; stopDotAnimation();
      setTimeout(()=>{window.location.href='https://yf.nasumicraft.de';},700);
    } else { setRetrying(); }
  }catch(e){ setRetrying(); } finally{ try{clearTimeout(timeout);}catch(e){} }
}

// Loop
function startCheckingLoop(){ checkStatus(); if(checkInterval) clearInterval(checkInterval); checkInterval=setInterval(checkStatus,4000); }

// Video Events
video.addEventListener('ended',()=>{ video.pause(); });
video.addEventListener('play',()=>{});
video.addEventListener('loadeddata',()=>{});

// Autoplay Fallback
function handleAutoplay(){
  const playPromise=video.play();
  if(playPromise!==undefined){ playPromise.then(()=>{}).catch(()=>{
    videoFallback.style.display='block'; videoFallback.style.cursor='pointer';
    videoFallback.addEventListener('click',()=>{ video.muted=false; video.play().then(()=>{videoFallback.style.display='none';}).catch(()=>{}); });
  }); }
}

// Fail Window
function showFailWindow(){ document.getElementById('failWindow').style.display='block'; }
function closeFailWindow(){ document.getElementById('failWindow').style.display='none'; }

// Init
setConnecting(); startDotAnimation(); startCheckingLoop(); handleAutoplay();
</script>
</body>
</html>
