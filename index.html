<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Verbinde …</title>
  <style>
    :root{
      --bg: #0b0d12;
      --fg: #eaf1ff;
      --muted: #a8b3cf;
      --accent: #7aa2ff;
    }
    html, body {
      height: 100%;
      margin: 0;
      /* nicht mehr background überschreiben! */
      background-color: var(--bg);
      color: var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      overflow: hidden;
      background-size: cover;
      background-position: center;
    }

    /* Fullscreen video */
    .bg-video {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: brightness(0.6);
      z-index: -1;
      background: #000;
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(1200px 600px at 20% 85%, rgba(122,162,255,.18), transparent 60%),
                  radial-gradient(900px 500px at 80% 10%, rgba(255,143,191,.12), transparent 60%);
      pointer-events: none;
      z-index: 0;
    }

    .status {
      position: fixed;
      left: 18px;
      bottom: 18px;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 14px;
      border-radius: 16px;
      background: rgba(12, 16, 24, 0.55);
      border: 1px solid rgba(122,162,255,0.22);
      box-shadow: 0 8px 30px rgba(0,0,0,.35);
      backdrop-filter: blur(6px);
      z-index: 2;
    }

    .spinner {
      width: 18px;
      height: 18px;
      border: 2.5px solid rgba(122,162,255,.25);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      flex: 0 0 auto;
      filter: drop-shadow(0 0 6px rgba(122,162,255,.55));
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .label { font-size: 15px; letter-spacing: .2px; }
    .muted { color: var(--muted); }

    .video-hidden { display: none !important; }

    @media (prefers-reduced-motion: reduce) {
      .spinner { animation: none; }
    }
  </style>
</head>
<body style="background-image: url('../bg.png');">
  <!-- Background video -->
  <video id="bgVideo" class="bg-video" autoplay muted playsinline preload="auto">
    <source src="../video-bg.mp4" type="video/mp4" />
  </video>
  <div class="overlay"></div>

  <div class="status">
    <div class="spinner"></div>
    <div class="label"><span id="statusText" class="muted">Verbinde mit Servern</span><span id="dots">.</span></div>
  </div>

  <script>
    const STATUS_URL = "https://yf.nasumicraft.de/status.txt";
    const REDIRECT_TO = "https://yf.nasumicraft.de";
    const CHECK_INTERVAL_MS = 3000;
    const TIMEOUT_MS = 4500;

    const statusTextEl = document.getElementById("statusText");
    const dotsEl = document.getElementById("dots");
    let dotStep = 0;
    setInterval(() => {
      dotStep = (dotStep + 1) % 3;
      dotsEl.textContent = ".".repeat(dotStep + 1);
    }, 500);

    function setStatus(text){ statusTextEl.textContent = text; }

    async function fetchWithTimeout(resource, timeout = TIMEOUT_MS) {
      const controller = new AbortController();
      const id = setTimeout(() => controller.abort(), timeout);
      try {
        return await fetch(resource, { cache:"no-store", mode:"cors", signal:controller.signal });
      } finally { clearTimeout(id); }
    }

    async function checkOnce() {
      try {
        const res = await fetchWithTimeout(STATUS_URL);
        if (res.ok) {
          window.location.replace(REDIRECT_TO);
          return true;
        }
      } catch(e){}
      return false;
    }

    async function startChecking() {
      setStatus("Verbinde mit Servern");
      let ok = await checkOnce();
      if (ok) return;
      setStatus("Keine Verbindung, versuche erneut");
      const interval = setInterval(async ()=>{
        if (await checkOnce()) clearInterval(interval);
        else setStatus("Keine Verbindung, versuche erneut");
      }, CHECK_INTERVAL_MS);
    }

    const bgVideo = document.getElementById("bgVideo");
    function hideVideo(){
      bgVideo.pause?.();
      bgVideo.classList.add("video-hidden");
    }
    bgVideo.addEventListener("ended", hideVideo);
    bgVideo.addEventListener("error", hideVideo);

    startChecking();
  </script>
</body>
</html>
